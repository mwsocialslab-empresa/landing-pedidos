let carrito = [];
let total = 0;

const productos = [
  { nombre: "Carne Picada", precio: 3500 },
  { nombre: "Pollo", precio: 2800 },
  { nombre: "Papa", precio: 900 }
];

const contenedor = document.getElementById("productos");

// CARGAR PRODUCTOS
productos.forEach((p, i) => {
  contenedor.innerHTML += `
    <div class="col-6 col-md-4 d-flex justify-content-center">
      <div class="card producto-card text-center p-3">

        <h6>${p.nombre}</h6>
        <small>$${p.precio} / kg</small>

        <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
          <button class="btn btn-outline-secondary btn-sm"
            onclick="cambiarCantidad(${i}, -0.5)">‚àí</button>

          <input 
            type="number"
            id="cant${i}"
            value="0"
            step="0.5"
            min="0"
            class="form-control text-center"
            style="width:70px"
            readonly
          >

          <button class="btn btn-outline-secondary btn-sm"
            onclick="cambiarCantidad(${i}, 0.5)">+</button>
        </div>

        <!-- üí∞ SUBTOTAL -->
        <div class="mt-2 fw-bold text-success">
          $<span id="sub${i}">0</span>
        </div>

        <button class="btn btn-success btn-sm mt-2"
          onclick="agregar(${i})">
          Agregar
        </button>

      </div>
    </div>
  `;
});

// ‚ûï‚ûñ CAMBIAR CANTIDAD
function cambiarCantidad(index, cambio) {
  const input = document.getElementById(`cant${index}`);
  let valor = parseFloat(input.value) + cambio;

  if (valor < 0) valor = 0;

  input.value = valor.toFixed(1);

  // actualizar subtotal
  const subtotal = valor * productos[index].precio;
  document.getElementById(`sub${index}`).innerText = subtotal;
}

// üõí AGREGAR AL CARRITO
function agregar(index) {
  const cantidad = parseFloat(
    document.getElementById(`cant${index}`).value
  );

  if (cantidad <= 0) {
    alert("Seleccion√° una cantidad");
    return;
  }

  const prod = productos[index];

  carrito.push({
    nombre: prod.nombre,
    precio: prod.precio,
    cantidad
  });

  total += prod.precio * cantidad;
  renderCarrito();

  // reset
  document.getElementById(`cant${index}`).value = 0;
  document.getElementById(`sub${index}`).innerText = "0";
}

// üßæ CARRITO
function renderCarrito() {
  const lista = document.getElementById("lista");
  const btnVaciar = document.getElementById("btnVaciar");

  lista.innerHTML = "";

  carrito.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "item";

    div.innerHTML = `
      <span>
        ${item.nombre} - ${item.cantidad} kg ‚Üí $${item.precio * item.cantidad}
      </span>
      <button class="btn btn-sm btn-danger" onclick="quitar(${index})">
        ‚ùå
      </button>
    `;

    lista.appendChild(div);
  });

  document.getElementById("total").textContent = total;
  btnVaciar.style.display = carrito.length ? "block" : "none";

  document.getElementById("btnVaciar").style.display =
  carrito.length > 0 ? "block" : "none";

}


// vaciar carrito
function vaciarCarrito() {
  carrito = [];
  total = 0;

  document.getElementById("lista").innerHTML = "";
  document.getElementById("total").textContent = "0";

  const modal = bootstrap.Modal.getInstance(
    document.getElementById("modalVaciar")
  );
  modal.hide();

  document.getElementById("btnVaciar").style.display = "none";
}


function quitar(index) {
  total -= carrito[index].precio * carrito[index].cantidad;
  carrito.splice(index, 1);
  renderCarrito();
}


function eliminar(index) {
  total -= carrito[index].precio * carrito[index].cantidad;
  carrito.splice(index, 1);
  renderCarrito();
}


// üì≤ WHATSAPP
function enviarPedidoWhatsApp() {
  if (carrito.length === 0) return alert("Carrito vac√≠o");

  const direccion = document.getElementById("direccion").value;
  if (!direccion) return alert("Ingres√° la direcci√≥n");

  let mensaje = "üõí Pedido:\n\n";

  carrito.forEach(p => {
    mensaje += `‚Ä¢ ${p.nombre} - ${p.cantidad}kg = $${p.precio * p.cantidad}\n`;
  });

  mensaje += `\nüìç Direcci√≥n: ${direccion}`;
  mensaje += `\nüí∞ Total: $${total}`;

  window.open(
    `https://wa.me/5491127461954?text=${encodeURIComponent(mensaje)}`
  );
}
